<!doctype html>
<html lang="fr">
<head>
  <!-- ... (ton code HTML existant) ... -->
</head>
<body>
  <!-- ... (ton code HTML existant) ... -->

  <!-- Firebase (compat) CDN: remplacez ensuite la config dans firebaseConfig -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

  <script>
    // ---------- CONFIGURATION ----------
    // Remplacez par votre config Firebase (Project settings -> SDK Web)
    const firebaseConfig = {
      apiKey: "VOTRE_APIKEY",
      authDomain: "VOTRE_AUTHDOMAIN",
      databaseURL: "VOTRE_DATABASE_URL",
      projectId: "VOTRE_PROJECTID",
      storageBucket: "VOTRE_STORAGEBUCKET",
      messagingSenderId: "VOTRE_MESSAGING_SENDER_ID",
      appId: "VOTRE_APPID"
    };

    // ---------- INIT ----------
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // ---------- UTIL ----------
    const BAN_WORDS = ['putain','con','salope','nique','connard'];
    function censor(text){
      let out = text;
      BAN_WORDS.forEach(w => {
        const re = new RegExp(w, 'ig');
        out = out.replace(re, m => '*'.repeat(m.length));
      });
      return out;
    }

    // presence id
    const uid = 'u_' + Math.random().toString(36).slice(2,9);

    // DOM
    const messagesEl = document.getElementById('messages');
    const sendBtn = document.getElementById('sendBtn');
    const msgInput = document.getElementById('msg');
    const nickInput = document.getElementById('nick');
    const viewerCountEl = document.getElementById('viewerCount');
    const modCountEl = document.getElementById('modCount');

    // presence
    const presenceRef = db.ref('presence/' + uid);
    presenceRef.set({nick: nickInput.value, ts: Date.now()});
    presenceRef.onDisconnect().remove();

    // update viewer count
    const presRoot = db.ref('presence');
    presRoot.on('value', snap => {
      const v = snap.val() || {};
      viewerCountEl.textContent = Object.keys(v).length;
    });

    // Ajouter un écouteur pour l'envoi de messages
    const sendMessage = () => {
      const nick = nickInput.value.trim();
      const msg = msgInput.value.trim();

      if (!nick || !msg) {
        alert('Veuillez entrer un pseudo et un message.');
        return;
      }

      const censoredMsg = censor(msg);
      const timestamp = Date.now();

      db.ref('messages').push({
        nick: nick,
        msg: censoredMsg,
        ts: timestamp
      });

      msgInput.value = ''; // Vider le champ message après envoi
    };

    sendBtn.addEventListener('click', sendMessage);
    msgInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        sendMessage();
      }
    });

    // Charger et afficher les messages
    msgsRef.limitToLast(200).on('value', snap => {
      const v = snap.val() || {};
      messagesEl.innerHTML = ''; // Vider la liste actuelle
      Object.keys(v).sort((a,b) => (v[a].ts||0)-(v[b].ts||0)).forEach(key => {
        const message = v[key];
        const msgDiv = document.createElement('div');
        msgDiv.classList.add('msg');
        msgDiv.innerHTML = `<span class="nick">${message.nick}:</span> ${message.msg}`;
        messagesEl.appendChild(msgDiv);
      });
      // Faire défiler vers le bas automatiquement
      messagesEl.scrollTop = messagesEl.scrollHeight;
    });
  </script>
</body>
</html>



