<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Stream Foot - Simple</title>
  <style>
    :root{--bg:#0f1720;--panel:#0b0f14;--accent:#c62828;--muted:#9aa4ad}
    body{margin:0;font-family:Arial,Helvetica,sans-serif;background:var(--bg);color:#fff;display:flex;min-height:100vh;align-items:flex-start;justify-content:center;padding:20px}
    .site{width:100%;max-width:1000px}
    header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
    .logo{font-weight:800;color:#fff;font-size:20px}
    .viewer{opacity:0.9}
    .layout{display:flex;gap:12px}
    .video-col{flex:1}
    .panel{background:var(--panel);border:2px solid var(--accent);padding:10px;border-radius:8px}
    .video-box{position:relative;height:420px;border-radius:6px;overflow:hidden;background:#000;display:flex;align-items:center;justify-content:center}
    video{width:100%;height:100%;object-fit:contain;background:#000}
    .expand-btn{position:absolute;top:10px;right:10px;background:var(--accent);border:none;padding:8px 10px;border-radius:6px;color:#fff;cursor:pointer}
    .note{margin-top:8px;background:var(--accent);padding:8px;border-radius:6px;text-align:center;font-weight:700}
    .chat-col{width:320px;display:flex;flex-direction:column;gap:10px}
    .messages{height:360px;overflow:auto;background:#051018;padding:8px;border-radius:6px}
    .msg{padding:6px;border-bottom:1px solid rgba(255,255,255,0.03)}
    .msg .nick{font-weight:700}
    .input-row{display:flex;gap:8px}
    input[type=text]{flex:1;padding:8px;border-radius:6px;border:none}
    button.send{background:var(--accent);border:none;padding:8px 10px;border-radius:6px;color:#fff;cursor:pointer}
    .rules{font-size:13px;opacity:0.9}
    .small{font-size:13px;opacity:0.8}
    /* Popup pseudo/reglement */
    #overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.85);display:flex;align-items:center;justify-content:center;z-index:1000}
    #overlay .box{background:#111;padding:20px;border-radius:8px;width:320px;text-align:center}
    #overlay input[type=text]{width:90%;margin-bottom:10px}
    #overlay button{background:var(--accent);border:none;padding:8px 12px;border-radius:6px;color:#fff;cursor:pointer;margin-top:10px}
  </style>
</head>
<body>
  <div id="overlay">
    <div class="box">
      <h3>Bienvenue sur Stream Foot</h3>
      <p>Entrez votre pseudo :</p>
      <input id="userNick" type="text" placeholder="Pseudo" />
      <p><input type="checkbox" id="acceptRules" /> J'accepte le règlement</p>
      <button id="startBtn">Entrer</button>
    </div>
  </div>

  <div class="site" style="display:none">
    <header>
      <div class="logo">Stream Foot - Simple</div>
      <div class="viewer small">Spectateurs: <span id="viewerCount">0</span></div>
    </header>

    <div class="layout">
      <div class="video-col">
        <div class="panel">
          <div class="video-box" id="videoBox">
            <video id="player" controls playsinline preload="metadata" src="https://www.w3schools.com/html/mov_bbb.mp4"></video>
            <button id="expandBtn" class="expand-btn">Agrandir</button>
          </div>
          <div class="note">Flux unique — agrandissez la vidéo</div>
        </div>
      </div>

      <div class="chat-col">
        <div class="panel" style="display:flex;flex-direction:column;gap:8px">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <strong>Chat</strong>
          </div>

          <div id="messages" class="messages" aria-live="polite"></div>

          <form id="chatForm" class="input-row" onsubmit="return false;">
            <input id="msg" type="text" placeholder="Message..." />
            <button id="sendBtn" class="send">Envoyer</button>
          </form>

          <div class="rules panel" style="background:transparent;border-color:rgba(255,255,255,0.04)">
            <div style="font-weight:700;margin-bottom:6px">Règlement</div>
            <ol>
              <li>Pas d'insultes (mots remplacés par des étoiles)</li>
              <li>10s entre chaque message</li>
              <li>Respectez les autres</li>
            </ol>
          </div>
        </div>
      </div>
    </div>

    <footer style="margin-top:12px;text-align:center;opacity:0.8">Stream Foot - Simple</footer>
  </div>

  <script>
    const BAN_WORDS = ['putain','con','salope','nique','connard'];
    function censor(text){
      let out = text;
      BAN_WORDS.forEach(w => {
        const re = new RegExp(w, 'ig');
        out = out.replace(re, m => '*'.repeat(m.length));
      });
      return out;
    }

    // pseudo + règlement
    const overlay = document.getElementById('overlay');
    const startBtn = document.getElementById('startBtn');
    const userNickInput = document.getElementById('userNick');
    const acceptRules = document.getElementById('acceptRules');
    const site = document.querySelector('.site');

    startBtn.addEventListener('click', () => {
      const nick = userNickInput.value.trim() || 'Anonyme';
      if (!acceptRules.checked){
        alert("Vous devez accepter le règlement !");
        return;
      }
      localStorage.setItem('sf_nick', nick);
      overlay.style.display = 'none';
      site.style.display = 'block';
      initChat();
    });

    function escapeHtml(s){
      return String(s).replace(/[&<>"']/g, function(c){return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[c];});
    }

    function initChat(){
      const messagesEl = document.getElementById('messages');
      const msgInput = document.getElementById('msg');
      const sendBtn = document.getElementById('sendBtn');

      // init chat messages from localStorage
      const chatKey = 'sf_chat';
      const lastResetKey = 'sf_last_reset';
      const now = Date.now();
      const lastReset = Number(localStorage.getItem(lastResetKey)||0);
      if(now - lastReset > 2*60*60*1000){ // 2h
        localStorage.setItem(chatKey, JSON.stringify([]));
        localStorage.setItem(lastResetKey, now);
      }

      let chat = JSON.parse(localStorage.getItem(chatKey)||'[]');

      function render(){
        messagesEl.innerHTML = '';
        chat.forEach(m=>{
          const div = document.createElement('div');
          div.className='msg';
          div.innerHTML='<div class="nick">'+escapeHtml(m.nick)+' <span style="font-weight:400;color:#9aa4ad;font-size:12px">· '+new Date(m.ts).toLocaleTimeString()+'</span></div><div class="text">'+escapeHtml(m.text)+'</div>';
          messagesEl.appendChild(div);
        });
        messagesEl.scrollTop = messagesEl.scrollHeight;
      }

      render();

      let lastMsgTs = Number(localStorage.getItem('sf_last_msg')||0);

      sendBtn.addEventListener('click', () => {
        const now = Date.now();
        if(now - lastMsgTs < 10000){
          alert('Veuillez attendre 10 secondes entre chaque message.');
          return;
        }
        const text = msgInput.value.trim();
        if(!text) return;
        const nick = localStorage.getItem('sf_nick')||'Anonyme';
        const cens = censor(text);
        const m = {nick, text:cens, ts:now};
        chat.push(m);
        localStorage.setItem(chatKey, JSON.stringify(chat));
        localStorage.setItem('sf_last_msg', now);
        lastMsgTs = now;
        msgInput.value='';
        render();
      });

      // compteur simple (nombre de pages ouvertes dans la session)
      const viewerCountEl = document.getElementById('viewerCount');
      let viewers = Number(sessionStorage.getItem('sf_viewers')||0);
      viewers++;
      sessionStorage.setItem('sf_viewers', viewers);
      viewerCountEl.textContent = viewers;

      // video expand
      const expandBtn = document.getElementById('expandBtn');
      const player = document.getElementById('player');
      const box = document.getElementById('videoBox');
      expandBtn.addEventListener('click', async () => {
        if(!document.fullscreenElement){
          if(box.requestFullscreen) await box.requestFullscreen();
          expandBtn.textContent='Réduire';
        } else {
          if(document.exitFullscreen) await document.exitFullscreen();
          expandBtn.textContent='Agrandir';
        }
      });
    }
  </script>
</body>
</html>

